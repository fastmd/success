<% provide(:title, 'ТО') %>


<script>
$(document).ready(function() {
    var t = $('#pstable1').DataTable( {
        "order": [[ 2, "asc" ]],
        "language": {
            "lengthMenu": "Отображать _MENU_ строк на странице",
            "zeroRecords": "Ничего не найдено - увы...",
            "info": "Страница _PAGE_ из _PAGES_",
            "infoEmpty": "Нет доступных строк",
            "infoFiltered": "(Отфильтровано из _MAX_ строк)",
            "search": "Поиск",
             "paginate": {
                first:      "<<",
                previous:   "<",
                next:       ">",
                last:       ">>"
            }
        },
        "pagingType": "full_numbers",
        "pageLength": 25,
         "fixedHeader": {
               headerOffset: ($('#navMenu').outerHeight() - 1)
         },
         responsive: {
            details: {
                type: 'column'
            }
        },
        columnDefs: [ {
            className: 'control',
            orderable: false,
            targets:   0
        }, {
            "searchable": false,
            "orderable": false,
            "targets": 1
            }
         ]      
    } ); 
    
    t.on( 'order.dt search.dt', function () {
        t.column(1, {search:'applied', order:'applied'}).nodes().each( function (cell, i) {
            cell.innerHTML = i+1;
        } );
    } ).draw();
    
} );
</script>	  	  
	 	  	
	<table id="pstable1" class="table table-bordered table-condensed table-hover table-striped dt-responsive nowrap compact" style="width:100%">			
			<thead>
				<tr  class="info">
					<th style="width:3%"></th>
			        <th style="width:2%" class="all"></th>
					<th class="all">Автомобиль</th>
					<th>Текущий пробег</th>
					<th>Техобслуживание</th>
					<th>Масло и фильтры</th>
					<th>Страховка</th>
					<th>Техосмотр</th>				
					<th>Стоимость<br /> за текущий месяц</th>
					<th>Стоимость<br /> за текущий год</th>
					<th class="none">.......</th>					
				</tr>
			</thead>
			<tfoot>
				<tr  class="info">
					<th style="width:3%"></th>
			        <th style="width:2%" class="all"></th>
					<th class="all">Автомобиль</th>
					<th>Текущий пробег</th>
					<th>ТO</th>
					<th>Масло и фильтры</th>
					<th>Страховка</th>
					<th>Техосмотр</th>				
					<th>Стоимость<br /> за текущий месяц</th>
					<th>Стоимость<br /> за текущий год</th>
					<th class="none">.......</th>					
				</tr>
			</tfoot>			
			<tbody>	
  	          <% @report.each do |item| %>
				<tr>
					<td></td>
					<td></td>
					<td><%= link_to "#{item[:marca_gnum]}",:controller => :tehservices, :action => :index ,:car_id => item[:car_id] %></td>
					<td><%= item[:parcurs][:parcurs] %> <%= item[:parcurs][:wdate] ? "(#{item[:parcurs][:wdate]})" : '' %></td>
					<td class=<%= if item[:to][:tored] then "danger" end %>><%= item[:to][:parcurs] %> <%= item[:to][:maxtosdate] ? "(#{item[:to][:maxtosdate]})" : '' %> <%= item[:dtto] ? "(#{item[:dtto]})" : '' %></td>
					<td class=<%= if item[:oil][:oilred] then "danger" end %>><%= item[:oil][:parcurs] %> <%= item[:oil][:maxoilsdate] ? "(#{ item[:oil][:maxoilsdate]})" : '' %> <%= item[:dtoil] ? "(#{item[:dtoil]})" : '' %></td>	
					<td class=<%= if item[:asig][:asigred] then "danger" end %>><%= item[:asig][:asigdt] %> <%= item[:asig][:maxasigsdate] ? "(#{ item[:asig][:maxasigsdate]})" : '' %></td>
					<td class=<%= if item[:tosm][:tosmred] then "danger" end %>><%= item[:tosm][:tosmdt] %> <%= item[:tosm][:maxtosmsdate] ? "(#{  item[:tosm][:maxtosmsdate]})" : '' %></td>					
					<td><%= number_to_currency(item[:monthsprice],:unit=>'€') %></td>
					<td><%= number_to_currency(item[:yearsprice],:unit=>'€') %></td>
					<td><%= link_to "Новое ТО", :controller => :tehservices, :action => :new ,:car_id => item[:car_id] %></td>	
				</tr>	
			   <% end %>
			</tbody>	
		</table>